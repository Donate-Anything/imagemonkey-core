<script src="/js/cookies.min.js"></script>

<div class="ui container">
  <div class="ui large secondary inverted pointing menu">
    <a class="toc item">
      <i class="sidebar icon"></i>
    </a>
  <a class="{{if (eq .activeMenuNr 1)}}active {{end}}item" href="/">Home</a>
  <a class="{{if (eq .activeMenuNr 2)}}active {{end}}item" href="/donate">Donate</a>
  <a class="{{if (eq .activeMenuNr 3)}}active {{end}}item" href="/label">Add Labels</a>
  <a class="{{if (eq .activeMenuNr 4)}}active {{end}}item" href="/annotate">Annotate</a>
  <a class="{{if (eq .activeMenuNr 5)}}active {{end}}item" href="/verify">Validate Label</a>
  <a class="{{if (eq .activeMenuNr 6)}}active {{end}}item" href="/verify_annotation">Validate Annotations</a>
  <a class="{{if (eq .activeMenuNr 7)}}active {{end}}item" href="/quiz">Quiz</a>

  <div class="ui dropdown item" id="datasetPointingMenuDropdown">
    Dataset<i class="dropdown icon"></i>
    <div class="menu">
      <div class="center aligned item" onclick="window.location='/statistics';">Statistics</div>
      <div class="center aligned item" onclick="window.location='/explore';">Explore</div>
    </div>
  </div>

  <div class="ui dropdown item" id="developersPointingMenuDropdown">
    Developers<i class="dropdown icon"></i>
    <div class="menu">
      <div class="center aligned item" onclick="window.location='/api';">API</div>
      <div class="center aligned item" onclick="window.location='/libraries';">Libraries</div>
    </div>
  </div>


  <a class="{{if (eq .activeMenuNr 10)}}active {{end}}item" href="/apps">Apps</a>
  <a class="{{if (eq .activeMenuNr 11)}}active {{end}}item" href="/playground">Playground</a>
  <a class="item" href="/blog">Blog</a>

  {{if (eq .sessionInformation.LoggedIn false)}}
  <a class="{{if (eq .activeMenuNr 12)}}active {{end}}item" href="/login">Login</a>
  {{ else }}
  <div class="ui dropdown item" id="mainMenuDropdown">
    <i class="user icon"></i> {{ .sessionInformation.Username }} <i class="dropdown icon"></i>
    <div class="menu">
      <div class="item" id="mainMenuProfileButton"><i class="user icon"></i>Profile</div>
      <div class="item" id="mainMenuLogoutButton"><i class="sign out icon"></i>Logout</div>
    </div>
  </div>
  {{ end }}
</div>
</div>


<script type="text/javascript">
  $(document).ready(function(){
    $('#mainMenuDropdown').dropdown();
    $('#developersPointingMenuDropdown').dropdown();
    $('#datasetPointingMenuDropdown').dropdown();

    function parseJwt(token){
      var base64Url = token.split('.')[1];
      var base64 = base64Url.replace('-', '+').replace('_', '/');
      return JSON.parse(window.atob(base64));
    };

    function logout(){
      $.ajax({
        type: "POST",
        url: "{{ .apiBaseUrl }}/v1/logout",
        beforeSend: function(xhr) {
          xhr.setRequestHeader("Authorization", "Bearer " + Cookies.get("imagemonkey"))
        },
        success: function(data){
          Cookies.expire("imagemonkey");
          window.location.href = "/"; //redirect to home page
        }
      });
    }

    $('#mainMenuLogoutButton').click(function(e) {
      logout();
    });

    $('#mainMenuProfileButton').click(function(e) {
      var username = parseJwt(Cookies.get("imagemonkey"))["username"]
      window.location.href = "/profile/" + username; //redirect to profile page
    });



  });

</script>