<script>
  function goToLabelEntryClicked(elem) {
    if($(elem).attr("data-unlocked") === "true") {
      $('#gotoModeLabelsDlg').modal({
        duration:0
      }).modal('hide');

      var url = $(elem).attr("data-url");
      window.open(url, '_blank');
    }
  }

  function addEntriesToGotoLabelsDlg(imageId, data) {
    var url = '';
    var div = '';
    var tooltip = '';
    var unlocked = '';
    for(var i = 0; i < data.length; i++) {
      url = '/verify?label_id=' + data[i]["uuid"] + '&image_id=' + imageId;
      unlocked = (data[i]["unlocked"]) ? 'true' : 'false';
      tooltip = (data[i]["unlocked"]) ? '' : ' data-tooltip="Label not yet unlocked"'; 
      
      div = '<div class="item">' +
              '<img class="ui avatar image" src="img/logo.png">' +
              '<div class="content">' +
                '<a class="header" data-unlocked="' + unlocked + '" data-url="' + url + '"' + tooltip +
                  ' onclick="goToLabelEntryClicked(this);">' + escapeHtml(data[i]["label"]) +'</a>'
              '</div>'
            '</div>';
      $("#gotoModeLabelsDlgContentList").append(div);


      //$("#gotoModeLabelsDlgContentList").append('<a class="item" data-url="' + url + '" onclick="goToLabelEntryClicked(this);">' + data[i]["label"] + '</a>');
      var sublabels = data[i]["sublabels"];
      if(sublabels !== undefined && sublabels !== null) {
        for(var j = 0; j < sublabels.length; j++) {
          url = '/verify?label_id=' + sublabels[j]["uuid"] + '&image_id=' + imageId;
          unlocked = (data[i]["unlocked"]) ? 'true' : 'false';
          tooltip = (data[i]["unlocked"]) ? '' : ' data-tooltip="Label not yet unlocked"'; 

          div = '<div class="item">' +
              '<img class="ui avatar image" src="img/logo.png">' +
              '<div class="content">' +
                '<a class="header" data-unlocked="' + unlocked + '" data-url="' + url + '"' + tooltip + 
                  '" onclick="goToLabelEntryClicked(this);">' + escapeHtml(sublabels[j]["name"]) + '/' + escapeHtml(data[i]["label"]) +'</a>'
              '</div>'
            '</div>';
          $("#gotoModeLabelsDlgContentList").append(div);
        }
      }
    }
  }

  function getLabelsForImage(imageId) {
    var url = "{{ .apiBaseUrl }}/v1/donation/" + imageId + "/label";
    $.ajax({
      url: url,
      dataType: 'json',
      success: function(data){
        addEntriesToGotoLabelsDlg(imageId, data)
      }
    });
  }

  $(document).ready(function(){
    getLabelsForImage($("#image").attr("imageId"));
  });
</script>

<div class="ui modal" id="gotoModeLabelsDlg">
  <div class="ui header">
    <h2 class="ui header">Select a label</h2>
  </div>
  <div class="scrolling content" id="gotoModeLabelsDlgContent">
    <div class="ui huge middle aligned divided list" id="gotoModeLabelsDlgContentList">
    </div>
  </div>
  <div class="actions">
    <div class="ui red cancel inverted button" id="confirmNoValidCancelButton">
      <i class="remove icon"></i>
      Cancel
    </div>
  </div>
</div>